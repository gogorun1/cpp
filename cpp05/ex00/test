#ifndef BUREAUCRAT_H
#define BUREAUCRAT_H

#include <iostream>
#include <string>
#include <exception>

class Bureaucrat {
private:
    const std::string _name;
    int _grade;

    // Helper function to check grade validity and throw exceptions
    void checkGrade(int grade);

public:
    // Nested Exception Classes
    class GradeTooHighException : public std::exception {
    public:
        // Use the noexcept specifier on the override function
        virtual const char* what() const noexcept;
    };

    class GradeTooLowException : public std::exception {
    public:
        virtual const char* what() const noexcept;
    };

    // Constructors and Destructor (Orthodox Canonical Form)
    Bureaucrat(const std::string& name, int grade); // Default/Parametrized Constructor
    Bureaucrat(const Bureaucrat& other);            // Copy Constructor
    ~Bureaucrat();                                  // Destructor
    Bureaucrat& operator=(const Bureaucrat& other); // Copy Assignment Operator

    // Getters
    const std::string& getName() const;
    int getGrade() const;

    // Member functions to manipulate the grade
    void incrementGrade();
    void decrementGrade();

    // Static constants for grade boundaries
    static const int HIGHEST_GRADE = 1;
    static const int LOWEST_GRADE = 150;
};

// Overload of the insertion operator (<<)
std::ostream& operator<<(std::ostream& os, const Bureaucrat& b);

#endif // BUREAUCRAT_H

#include "Bureaucrat.h"

// --- Nested Exception Implementation ---

const char* Bureaucrat::GradeTooHighException::what() const noexcept {
    return "Bureaucrat exception: Grade is too high (must be 1-150).";
}

const char* Bureaucrat::GradeTooLowException::what() const noexcept {
    return "Bureaucrat exception: Grade is too low (must be 1-150).";
}

// --- Private Helper Function ---

/**
 * @brief Checks if a grade is within the valid range (1 to 150) and throws 
 * the appropriate exception if it is not.
 * @param grade The grade to check.
 */
void Bureaucrat::checkGrade(int grade) {
    if (grade < HIGHEST_GRADE) {
        throw Bureaucrat::GradeTooHighException();
    }
    if (grade > LOWEST_GRADE) {
        throw Bureaucrat::GradeTooLowException();
    }
}

// --- Orthodox Canonical Form Implementations ---

// Parametrized Constructor
Bureaucrat::Bureaucrat(const std::string& name, int grade) 
    : _name(name), _grade(grade) {
    // Check the grade upon construction
    checkGrade(_grade);
    std::cout << "Bureaucrat " << _name << " created with grade " << _grade << "." << std::endl;
}

// Copy Constructor
Bureaucrat::Bureaucrat(const Bureaucrat& other) 
    : _name(other._name), _grade(other._grade) {
    std::cout << "Bureaucrat " << _name << " copied." << std::endl;
}

// Destructor
Bureaucrat::~Bureaucrat() {
    std::cout << "Bureaucrat " << _name << " destroyed." << std::endl;
}

// Copy Assignment Operator
Bureaucrat& Bureaucrat::operator=(const Bureaucrat& other) {
    // Since _name is const, we can only copy the non-const members.
    // In a proper OCF, all members are copied. A const name means this
    // assignment operator is generally non-standard/unwise, but for this
    // exercise, we copy what we can.
    if (this != &other) {
        // The name member is const and cannot be assigned to.
        // We only assign the grade.
        _grade = other._grade;
        std::cout << "Bureaucrat " << _name << " assigned grade " << _grade << "." << std::endl;
    }
    return *this;
}

// --- Getters ---

const std::string& Bureaucrat::getName() const {
    return _name;
}

int Bureaucrat::getGrade() const {
    return _grade;
}

// --- Grade Manipulation ---

/**
 * @brief Attempts to increase the bureaucrat's grade (e.g., 3 -> 2).
 * Throws GradeTooHighException if grade is already 1.
 */
void Bureaucrat::incrementGrade() {
    // Check the next grade BEFORE assignment
    checkGrade(_grade - 1);
    _grade--;
    std::cout << _name << "'s grade incremented to " << _grade << "." << std::endl;
}

/**
 * @brief Attempts to decrease the bureaucrat's grade (e.g., 2 -> 3).
 * Throws GradeTooLowException if grade is already 150.
 */
void Bureaucrat::decrementGrade() {
    // Check the next grade BEFORE assignment
    checkGrade(_grade + 1);
    _grade++;
    std::cout << _name << "'s grade decremented to " << _grade << "." << std::endl;
}

// --- Insertion Operator Overload ---

/**
 * @brief Overloads the << operator to print bureaucrat information.
 * Format: <name>, bureaucrat grade <grade>.
 */
std::ostream& operator<<(std::ostream& os, const Bureaucrat& b) {
    os << b.getName() << ", bureaucrat grade " << b.getGrade() << ".";
    return os;
}